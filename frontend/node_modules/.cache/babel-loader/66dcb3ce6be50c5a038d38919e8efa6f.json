{"ast":null,"code":"import _objectSpread from \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\n\n(function () {\n  var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;\n  enterModule && enterModule(module);\n})();\n\nvar __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {\n  return a;\n};\n\nimport { useEffect, useCallback } from 'react';\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\nimport { HOME_DOWNLOAD_FILE_BEGIN, HOME_DOWNLOAD_FILE_SUCCESS, HOME_DOWNLOAD_FILE_FAILURE, HOME_DOWNLOAD_FILE_DISMISS_ERROR } from './constants';\nimport { message } from \"antd\";\nimport Axios from 'axios';\nexport function downloadFile(path) {\n  return function (dispatch) {\n    dispatch({\n      type: HOME_DOWNLOAD_FILE_BEGIN\n    }); // const uploadUrl = isConan?\"/conan/file\":\"/spine/file\"\n    // Axios.defaults.baseURL = 'https://diagpanel.azurewebsites.net';\n\n    Axios.defaults.baseURL = 'http://127.0.0.1:8080';\n    var url = \"spine/file/\".concat(path);\n    return Axios('spine/file/1101', {\n      method: 'get',\n      responseType: 'blob'\n    }).then(function (res) {\n      var data = res.data,\n          headers = res.headers;\n      var fileName = headers['content-disposition'].replace(/\\w+;filename=(.*)/, '$1'); // 此处当返回json文件时需要先对data进行JSON.stringify处理，其他类型文件不用做处理\n      //const blob = new Blob([JSON.stringify(data)], ...)\n\n      var blob = new Blob([data], {\n        type: headers['content-type']\n      });\n      var dom = document.createElement('a');\n      var url = window.URL.createObjectURL(blob);\n      dom.href = url;\n      dom.download = decodeURI(fileName);\n      dom.style.display = 'none';\n      document.body.appendChild(dom);\n      dom.click();\n      dom.parentNode.removeChild(dom);\n      window.URL.revokeObjectURL(url); // dispatch({\n      //   type: HOME_DOWNLOAD_FILE_SUCCESS,\n      //   data: null,\n      // });\n    }).catch(function (err) {\n      dispatch({\n        type: HOME_DOWNLOAD_FILE_FAILURE,\n        data: {\n          error: err\n        }\n      });\n      message.error(\"failed to download\");\n    });\n  };\n}\nexport function dismissDownloadFileError() {\n  return {\n    type: HOME_DOWNLOAD_FILE_DISMISS_ERROR\n  };\n}\nexport function useDownloadFile() {\n  var dispatch = useDispatch();\n\n  var _useSelector = useSelector(function (state) {\n    return {\n      downloadFilePending: state.home.downloadFilePending,\n      downloadFileError: state.home.downloadFileError\n    };\n  }, shallowEqual),\n      downloadFilePending = _useSelector.downloadFilePending,\n      downloadFileError = _useSelector.downloadFileError;\n\n  var boundAction = useCallback(function () {\n    return dispatch(downloadFile.apply(void 0, arguments));\n  }, [dispatch]);\n  var boundDismissError = useCallback(function () {\n    return dispatch(dismissDownloadFileError());\n  }, [dispatch]);\n  return {\n    downloadFile: boundAction,\n    downloadFilePending: downloadFilePending,\n    downloadFileError: downloadFileError,\n    dismissDownloadFileError: boundDismissError\n  };\n}\n\n__signature__(useDownloadFile, \"useDispatch{dispatch}\\nuseSelector{{ downloadFilePending, downloadFileError }}\\nuseCallback{boundAction}\\nuseCallback{boundDismissError}\", function () {\n  return [useDispatch, useSelector];\n});\n\nexport function reducer(state, action) {\n  switch (action.type) {\n    case HOME_DOWNLOAD_FILE_BEGIN:\n      // Just after a request is sent\n      return _objectSpread({}, state, {\n        downloadFilePending: true,\n        downloadFileError: null\n      });\n\n    case HOME_DOWNLOAD_FILE_SUCCESS:\n      // The request is success\n      return _objectSpread({}, state, {\n        downloadFilePending: false,\n        downloadFileError: null\n      });\n\n    case HOME_DOWNLOAD_FILE_FAILURE:\n      // The request is failed\n      return _objectSpread({}, state, {\n        downloadFilePending: false,\n        downloadFileError: action.data.error\n      });\n\n    case HOME_DOWNLOAD_FILE_DISMISS_ERROR:\n      // Dismiss the request failure error\n      return _objectSpread({}, state, {\n        downloadFileError: null\n      });\n\n    default:\n      return state;\n  }\n}\n;\n\n(function () {\n  var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;\n\n  if (!reactHotLoader) {\n    return;\n  }\n\n  reactHotLoader.register(downloadFile, \"downloadFile\", \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/src/features/home/redux/downloadFile.js\");\n  reactHotLoader.register(dismissDownloadFileError, \"dismissDownloadFileError\", \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/src/features/home/redux/downloadFile.js\");\n  reactHotLoader.register(useDownloadFile, \"useDownloadFile\", \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/src/features/home/redux/downloadFile.js\");\n  reactHotLoader.register(reducer, \"reducer\", \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/src/features/home/redux/downloadFile.js\");\n})();\n\n;\n\n(function () {\n  var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;\n  leaveModule && leaveModule(module);\n})();","map":{"version":3,"sources":["/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/src/features/home/redux/downloadFile.js"],"names":["useEffect","useCallback","useDispatch","useSelector","shallowEqual","HOME_DOWNLOAD_FILE_BEGIN","HOME_DOWNLOAD_FILE_SUCCESS","HOME_DOWNLOAD_FILE_FAILURE","HOME_DOWNLOAD_FILE_DISMISS_ERROR","message","Axios","downloadFile","path","dispatch","type","defaults","baseURL","url","method","responseType","then","res","data","headers","fileName","replace","blob","Blob","dom","document","createElement","window","URL","createObjectURL","href","download","decodeURI","style","display","body","appendChild","click","parentNode","removeChild","revokeObjectURL","catch","err","error","dismissDownloadFileError","useDownloadFile","state","downloadFilePending","home","downloadFileError","boundAction","boundDismissError","reducer","action"],"mappings":"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","sourcesContent":["import { useEffect, useCallback } from 'react';\nimport { useDispatch, useSelector, shallowEqual } from 'react-redux';\nimport {\n  HOME_DOWNLOAD_FILE_BEGIN,\n  HOME_DOWNLOAD_FILE_SUCCESS,\n  HOME_DOWNLOAD_FILE_FAILURE,\n  HOME_DOWNLOAD_FILE_DISMISS_ERROR,\n} from './constants';\nimport {message} from \"antd\";\nimport Axios from 'axios';\n\nexport function downloadFile(path) {\n    return dispatch => {\n      dispatch({\n        type: HOME_DOWNLOAD_FILE_BEGIN,\n      });\n     // const uploadUrl = isConan?\"/conan/file\":\"/spine/file\"\n    // Axios.defaults.baseURL = 'https://diagpanel.azurewebsites.net';\n      Axios.defaults.baseURL = 'http://127.0.0.1:8080'\n      const url = `spine/file/${path}`\n      return Axios('spine/file/1101',{\n        method: 'get',\n        responseType: 'blob',\n      })\n      .then((res)=>{\n        const { data, headers } = res\n        const fileName = headers['content-disposition'].replace(/\\w+;filename=(.*)/, '$1')\n        // 此处当返回json文件时需要先对data进行JSON.stringify处理，其他类型文件不用做处理\n        //const blob = new Blob([JSON.stringify(data)], ...)\n        const blob = new Blob([data], {type: headers['content-type']})\n        let dom = document.createElement('a')\n        let url = window.URL.createObjectURL(blob)\n        dom.href = url\n        dom.download = decodeURI(fileName)\n        dom.style.display = 'none'\n        document.body.appendChild(dom)\n        dom.click()\n        dom.parentNode.removeChild(dom)\n        window.URL.revokeObjectURL(url)\n          // dispatch({\n          //   type: HOME_DOWNLOAD_FILE_SUCCESS,\n          //   data: null,\n          // });\n      })\n      .catch((err)=>{\n        dispatch({\n            type: HOME_DOWNLOAD_FILE_FAILURE,\n            data: { error: err },\n          });\n          message.error(\"failed to download\")\n      })\n  };\n}\n\nexport function dismissDownloadFileError() {\n  return {\n    type: HOME_DOWNLOAD_FILE_DISMISS_ERROR,\n  };\n}\n\nexport function useDownloadFile() {\n  const dispatch = useDispatch();\n\n  const { downloadFilePending, downloadFileError } = useSelector(\n    state => ({\n      downloadFilePending: state.home.downloadFilePending,\n      downloadFileError: state.home.downloadFileError,\n    }),\n    shallowEqual,\n  );\n\n  const boundAction = useCallback((...args) => {\n    return dispatch(downloadFile(...args));\n  }, [dispatch]);\n\n  const boundDismissError = useCallback(() => {\n    return dispatch(dismissDownloadFileError());\n  }, [dispatch]);\n\n  return {\n    downloadFile: boundAction,\n    downloadFilePending,\n    downloadFileError,\n    dismissDownloadFileError: boundDismissError,\n  };\n}\n\nexport function reducer(state, action) {\n  switch (action.type) {\n    case HOME_DOWNLOAD_FILE_BEGIN:\n      // Just after a request is sent\n      return {\n        ...state,\n        downloadFilePending: true,\n        downloadFileError: null,\n      };\n\n    case HOME_DOWNLOAD_FILE_SUCCESS:\n      // The request is success\n      return {\n        ...state,\n        downloadFilePending: false,\n        downloadFileError: null,\n      };\n\n    case HOME_DOWNLOAD_FILE_FAILURE:\n      // The request is failed\n      return {\n        ...state,\n        downloadFilePending: false,\n        downloadFileError: action.data.error,\n      };\n\n    case HOME_DOWNLOAD_FILE_DISMISS_ERROR:\n      // Dismiss the request failure error\n      return {\n        ...state,\n        downloadFileError: null,\n      };\n\n    default:\n      return state;\n  }\n}\n"]},"metadata":{},"sourceType":"module"}