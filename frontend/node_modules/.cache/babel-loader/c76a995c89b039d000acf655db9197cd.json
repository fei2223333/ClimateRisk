{"ast":null,"code":"import _regeneratorRuntime from \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _slicedToArray from \"/Users/shuge/Documents/project/rekit-project/diagpanel2/ServiceWebsite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport { __awaiter } from \"tslib\";\nimport React from 'react';\nimport { usePositionStyle } from '../../common/position';\nimport { GraphConfig, createX6GraphModule } from '../graph';\nimport { useExtensionRegistry } from './extension-context';\nimport { useXflowPrefixCls } from './global-config-context';\nimport { usePortal } from '@antv/x6-react-shape';\nimport { useXFlowApp } from './app-context';\nexport var XFlowCanvas = function XFlowCanvas(props) {\n  var app = useXFlowApp();\n  /** x6画布parent的dom节点 */\n\n  var rootRef = React.useRef(null);\n  /** x6画布的dom节点 */\n\n  var canvasRef = React.useRef(null);\n  /** 生成配置中心 */\n\n  var extensionRegistry = useExtensionRegistry();\n  /** 获取ContextService的配置 */\n\n  var graphConfig = React.useMemo(function () {\n    var config = props.config ? props.config : new GraphConfig();\n    config.setX6Config();\n    return config;\n    /** 保证只生成一次 */\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  /** X6_NODE_PORTAL_NODE_VIEW */\n\n  var _usePortal = usePortal(graphConfig.graphId),\n      _usePortal2 = _slicedToArray(_usePortal, 2),\n      Portal = _usePortal2[0],\n      setGraph = _usePortal2[1];\n\n  React.useEffect(function () {\n    app && app.getGraphInstance().then(function (graph) {\n      setGraph(graph);\n    });\n  }, [app, setGraph]);\n  React.useEffect(function () {\n    /** 设置画布parent dom节点、画布dom节点 */\n    graphConfig.setRootContainer(rootRef.current);\n    graphConfig.setGraphContainer(canvasRef.current);\n    /** 关联XflowApp和Graph*/\n\n    graphConfig.xflowInstanceId = extensionRegistry.getInstaceId();\n    extensionRegistry.addCoreModule({\n      config: graphConfig,\n      createModule: createX6GraphModule\n    });\n    /** unmount */\n\n    var destroy = function destroy() {\n      return __awaiter(void 0, void 0, void 0, /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n        return _regeneratorRuntime.wrap(function _callee$(_context) {\n          while (1) {\n            switch (_context.prev = _context.next) {\n              case 0:\n                graphConfig.dispose();\n\n              case 1:\n              case \"end\":\n                return _context.stop();\n            }\n          }\n        }, _callee);\n      }));\n    };\n\n    return function () {\n      destroy();\n    };\n    /** 保证只生成一次 */\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  var style = usePositionStyle(props.position);\n  var rootClz = useXflowPrefixCls('canvas-root');\n  var canvasClz = useXflowPrefixCls('x6-canvas');\n  return React.createElement(React.Fragment, null, React.createElement(\"div\", {\n    ref: rootRef,\n    className: rootClz,\n    style: style,\n    id: graphConfig.graphId,\n    tabIndex: 0\n  }, React.createElement(\"div\", {\n    ref: canvasRef,\n    className: canvasClz\n  }), props.children), React.createElement(Portal, null));\n};\nXFlowCanvas.defaultProps = {\n  isXFlowCanvas: true\n};","map":null,"metadata":{},"sourceType":"module"}