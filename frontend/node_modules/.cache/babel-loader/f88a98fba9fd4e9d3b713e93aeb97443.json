{"ast":null,"code":"import _defineProperty from \"/Users/shuge/Documents/project/rekit-project/Spine/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _slicedToArray from \"/Users/shuge/Documents/project/rekit-project/Spine/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport React, { useState, useEffect } from 'react';\nimport { FlowchartFormWrapper } from '../../form-wrapper';\nimport { ColorPicker, InputNumberFiled, InputFiled, SelectField } from './fields';\nimport { PREFIX, DefaultEdgeConfig, ArrowStrokeMaps, ArrowMaps } from './constants';\n\nvar EdgeComponent = function EdgeComponent(props) {\n  var config = props.config,\n      _props$plugin = props.plugin,\n      plugin = _props$plugin === void 0 ? {} : _props$plugin;\n  var updateEdge = plugin.updateEdge;\n\n  var _useState = useState(Object.assign(Object.assign({}, DefaultEdgeConfig), config)),\n      _useState2 = _slicedToArray(_useState, 2),\n      edgeConfig = _useState2[0],\n      setEdgeConfig = _useState2[1];\n\n  useEffect(function () {\n    setEdgeConfig(Object.assign(Object.assign({}, DefaultEdgeConfig), config));\n  }, [config]);\n\n  var getAttrs = function getAttrs(key) {\n    var type = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'line';\n\n    var _a;\n\n    var _edgeConfig$attrs = edgeConfig.attrs,\n        attrs = _edgeConfig$attrs === void 0 ? {} : _edgeConfig$attrs;\n    return (_a = attrs[type]) === null || _a === void 0 ? void 0 : _a[key];\n  };\n\n  var getArrowValue = function getArrowValue() {\n    var _a, _b, _c, _d, _e;\n\n    var _edgeConfig$attrs2 = edgeConfig.attrs,\n        attrs = _edgeConfig$attrs2 === void 0 ? {} : _edgeConfig$attrs2;\n    var _attrs$line = attrs.line,\n        line = _attrs$line === void 0 ? {} : _attrs$line;\n\n    if (((_a = line.sourceMarker) === null || _a === void 0 ? void 0 : _a.name) && ((_b = line.targetMarker) === null || _b === void 0 ? void 0 : _b.name)) {\n      return 'all';\n    }\n\n    if (!((_c = line.sourceMarker) === null || _c === void 0 ? void 0 : _c.name) && !((_d = line.targetMarker) === null || _d === void 0 ? void 0 : _d.name)) {\n      return 'none';\n    }\n\n    if ((_e = line.sourceMarker) === null || _e === void 0 ? void 0 : _e.name) {\n      return 'source';\n    }\n\n    return 'target';\n  };\n\n  var getSrokeDashValue = function getSrokeDashValue() {\n    var _edgeConfig$attrs3 = edgeConfig.attrs,\n        attrs = _edgeConfig$attrs3 === void 0 ? {} : _edgeConfig$attrs3;\n    var _attrs$line2 = attrs.line,\n        line = _attrs$line2 === void 0 ? {} : _attrs$line2;\n    return line.strokeDasharray ? 'dash' : 'solid';\n  };\n\n  var onEdgeConfigChange = function onEdgeConfigChange(key, value) {\n    var type = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 'line';\n\n    var _a, _b;\n    /** 全量更新，简化逻辑 */\n\n\n    if (key === 'arrow') {\n      setEdgeConfig(Object.assign(Object.assign({}, edgeConfig), {\n        attrs: Object.assign(Object.assign({}, edgeConfig.attrs), _defineProperty({}, type, Object.assign(Object.assign({}, (_a = edgeConfig.attrs) === null || _a === void 0 ? void 0 : _a[type]), value)))\n      }));\n    } else {\n      var _Object$assign4;\n\n      setEdgeConfig(Object.assign(Object.assign({}, edgeConfig), (_Object$assign4 = {}, _defineProperty(_Object$assign4, key, value), _defineProperty(_Object$assign4, \"attrs\", Object.assign(Object.assign({}, edgeConfig.attrs), _defineProperty({}, type, Object.assign(Object.assign({}, (_b = edgeConfig.attrs) === null || _b === void 0 ? void 0 : _b[type]), _defineProperty({}, key, value))))), _Object$assign4)));\n    }\n\n    updateEdge(_defineProperty({}, key, value), type, key === 'arrow' ? 'arrow' : '');\n  };\n\n  return React.createElement(\"div\", {\n    className: \"\".concat(PREFIX, \"-panel-body\")\n  }, React.createElement(\"div\", {\n    className: \"\".concat(PREFIX, \"-panel-group\")\n  }, React.createElement(\"h5\", null, \"\\u5185\\u5BB9\"), React.createElement(InputFiled, {\n    label: \"\\u6807\\u7B7E\",\n    value: edgeConfig.label,\n    onChange: function onChange(value) {\n      onEdgeConfigChange('label', value);\n    }\n  })), React.createElement(\"h5\", {\n    style: {\n      marginBottom: 12\n    }\n  }, \"\\u6837\\u5F0F\"), React.createElement(\"div\", {\n    className: \"\".concat(PREFIX, \"-panel-group\"),\n    style: {\n      marginBottom: 0\n    }\n  }, React.createElement(\"h5\", null, \"\\u7EBF\"), React.createElement(SelectField, {\n    label: \"\\u7BAD\\u5934\",\n    value: getArrowValue(),\n    width: \"100%\",\n    options: [{\n      label: '正向',\n      value: 'target'\n    }, {\n      label: '逆向',\n      value: 'source'\n    }, {\n      label: '双向',\n      value: 'all'\n    }, {\n      label: '无',\n      value: 'none'\n    }],\n    onChange: function onChange(value) {\n      onEdgeConfigChange('arrow', ArrowMaps[value], 'line');\n    }\n  }), React.createElement(\"div\", {\n    className: \"\".concat(PREFIX, \"-edge-stroke-style\")\n  }, React.createElement(SelectField, {\n    label: \"\\u7EBF\\u5F62\",\n    width: 68,\n    value: getSrokeDashValue(),\n    options: [{\n      label: '实线',\n      value: 'solid'\n    }, {\n      label: '虚线',\n      value: 'dash'\n    }],\n    onChange: function onChange(value) {\n      onEdgeConfigChange('strokeDasharray', ArrowStrokeMaps[value], 'line');\n    }\n  }), React.createElement(InputNumberFiled, {\n    value: getAttrs('strokeWidth'),\n    min: 1,\n    onChange: function onChange(value) {\n      onEdgeConfigChange('strokeWidth', value, 'line');\n    }\n  })), React.createElement(ColorPicker, {\n    label: \"\\u8FB9\\u6846\",\n    value: getAttrs('stroke'),\n    onChange: function onChange(value) {\n      onEdgeConfigChange('stroke', value, 'line');\n    }\n  })), React.createElement(\"div\", {\n    className: \"\".concat(PREFIX, \"-panel-group\")\n  }, React.createElement(\"h5\", null, \"\\u6807\\u7B7E\"), React.createElement(\"div\", {\n    className: \"\".concat(PREFIX, \"-edge-text-style\")\n  }, React.createElement(InputNumberFiled, {\n    label: \"\\u5B57\\u53F7\",\n    min: 10,\n    width: 68,\n    value: getAttrs('fontSize', 'text') || 12,\n    onChange: function onChange(value) {\n      onEdgeConfigChange('fontSize', value, 'text');\n    }\n  }), React.createElement(ColorPicker, {\n    value: getAttrs('fill', 'text') || '#000',\n    onChange: function onChange(value) {\n      onEdgeConfigChange('fill', value, 'text');\n    }\n  }))));\n};\n\nexport var EdgeService = function EdgeService(props) {\n  return React.createElement(FlowchartFormWrapper, Object.assign({}, props, {\n    type: \"edge\"\n  }), function (config, plugin) {\n    return React.createElement(EdgeComponent, Object.assign({}, props, {\n      plugin: plugin,\n      config: config\n    }));\n  });\n};","map":null,"metadata":{},"sourceType":"module"}